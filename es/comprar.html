<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Conectar MetaMask + Comprar con Transak</title>
  <script src="https://cdn.jsdelivr.net/npm/@metamask/sdk/dist/browser/MetaMaskSDK.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    iframe { width: 100%; height: 600px; border: none; margin-top: 20px; }
    button { padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>

  <h1>Conectar MetaMask y Comprar Cripto con Transak</h1>

  <button id="connectButton">Conectar MetaMask</button>

  <div id="walletAddress" style="margin-top: 1em;"></div>

  <div id="transakWidget"></div>

  <script>
    // Inicializar MetaMask SDK
    const MMSDK = new MetaMaskSDK.MetaMaskSDK({
      dappMetadata: {
        name: "TuDapp",
        url: window.location.href
      }
    });

    const ethereum = MMSDK.getProvider(); // similar a window.ethereum

    const connectButton = document.getElementById("connectButton");
    const walletDisplay = document.getElementById("walletAddress");

    connectButton.onclick = async () => {
      try {
        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
        const userAddress = accounts[0];
        walletDisplay.innerText = "Conectado: " + userAddress;

        // Cargar Transak widget embebido con dirección
        const transakDiv = document.getElementById("transakWidget");
        const transakUrl = `https://global.transak.com?apiKey=YOUR_TRANSAK_API_KEY&walletAddress=${userAddress}&defaultCryptoCurrency=USDC&network=polygon&disableWalletAddressForm=true`;
        
        transakDiv.innerHTML = `<iframe src="${transakUrl}"></iframe>`;

      } catch (error) {
        console.error("Error al conectar MetaMask", error);
        alert("Ocurrió un error al conectar con MetaMask.");
      }
    };
  </script>

</body>
</html>
